workflows:

  init:
    setup_queries:
      - load_shoppers
      - load_products
      - load_baskets

  read:
    vus: 1
    queries:
      - name: fetch_products
        rate: 1/1s

activities:

  load_shoppers:
    type: batch
    args:
      - type: gen
        value: uuid
      - type: gen
        value: email
    batch:
      total: 10000
      size: 1000
      table: shopper
      columns:
        - id
        - email
      returning:
        - id

  load_products:
    type: batch
    args:
      - type: gen
        value: uuid
      - type: gen
        value: product_name
      - type: float
        min: 1
        max: 100
    batch:
      total: 10000
      size: 1000
      table: product
      columns:
        - id
        - name
        - price
      returning:
        - id
  
  load_baskets:
    type: batch
    args:
      - type: ref
        query: load_shoppers
        column: id
      - type: ref
        query: load_products
        column: id
      - type: int
        min: 1
        max: 5
    batch:
      total: 10000
      size: 1000
      table: basket
      columns:
        - shopper_id
        - product_id
        - quantity

  fetch_products:
    type: query
    args:
      - type: float
        min: 10
        max: 50
      - type: int
        min: 10
        max: 10
    query: |-
      SELECT id
      FROM product
      WHERE price <= $1
      LIMIT $2